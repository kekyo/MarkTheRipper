---
title: Layout Basics
lang: en-us
date: 10/26/2022 22:24:54 +09:00
---

The "Layout" corresponds to the HTML template of an article.
MarkTheRipper generates HTML based on the information written in the markdown,
but by defining this HTML in the layout.
You can flexibly customize the page.

MarkTheRipper layouts are very simple, yet flexible and applicable enough for your needs.
The layouts provide all keyword substitutions by referencing a "Metadata dictionary".

Here is an example of a layout substitution.

## Keyword Substitution

The simplest example is a simple keyword substitution. Suppose you define the following layout:

```html
<title>{title}</title>
```

This will replace the keyword `title` in the metadata dictionary with the corresponding value.
The value of `title` is defined at the beginning of the corresponding markdown document:

```markdown
---
title: Hello MarkTheRipper!
---

(... Body ...)
```

If you have tried other site generators, you may know how to add these special "header lines" to your markdown to insert a title, date, tags and etc.
MarkTheRipper also follows this convention syntactically, but is more flexible.
For example, the following example produces exactly the same result:

```html
<title>{foobar}</title>
```

```markdown
---
foobar: Hello MarkTheRipper!
---

(... Body ...)
```

* Note: This header is called "FrontMatter" in other site generators and is written in YAML syntax.
  However, MarkTheRipper does not strictly use YAML,
  because uses a syntax that allows for greater flexibility in text.
  For example, `title` is not required to be enclosed in double quotes,
  and `tags` is correctly recognized without square brackets.
  For the record, MarkTheRipper does not use the term "FrontMatter."

Do you somehow see how you can make use of metadata dictionaries?
In other words, MarkTheRipper can treat any set of "key-value" pairs you write in the markdown header as a metadata dictionary,
and you can reflect any number of them on the layout.

Arbitrary keywords can be substituted anywhere on the layout,
allowing for example the following applications:

```html
<link rel="stylesheet" href="{stylesheet}.css">
```

```markdown
---
title: Hello MarkTheRipper!
stylesheet: darcula
---

(... Body ...)
```

Perhaps this feature alone will solve most of the problems.

## Special keywords and fallbacks

There are several special but potentially important keywords in this metadata dictionary.
They are listed below:

|Keyword|Note|
|:----|:----|
|`generated`|Date and time when the site was generated.|
|`layout`|The name of the layout to apply.|
|`lang`|Locale (`en-us`, `ja-jp`, etc.)|
|`date`|Date of the post.|
|`timezone`|Timezone of the environment in which the site was generated by MarkTheRipper, in IANA notation, or time.|
|`published`|Ignore this markdown by explicitly specifying `false`.|

* There are several other special keywords, which will be explained later.

These keywords can be overridden by writing them in the markdown header.
It may not make sense to override `generated`, but just know that MarkTheRipper does not treat metadata dictionary definitions specially.

You may be wondering what the default values of `lang`, `layout` and `timezone` are.
Metadata dictionaries can be placed in `metadata.json`,
which is the base definition for site generation.
(It does not have to be there. In fact, it is not present in the minimum samples.)
For example, the following definition:

```json
{
  "title": "(Draft)",
  "author": "Mark the Ripper",
  "layout": "page",
  "lang": "en-us",
  "timezone": "America/Los_Angeles"
}
```

This reveals something interesting. The value of the `title` keyword is "(Draft)".
For example, consider the following layout:

```html
<meta name="author" content="{author}" />
<title>{title}</title>
```

If you specify `title` in the markdown, that title will be inserted,
otherwise the title "(Draft)" will be inserted.
Similarly, if `author` is specified, the name of author will be inserted,
otherwise "Mark the Ripper" will be inserted.

If you are thinking of using this for a blog, you may not want to put your name in the header of the markdown,
since most of your posts will be written by yourself.
However, the title will of course be different for each post.
In such cases, you can use the "fallback" feature of the metadata dictionary.

And as for the `lang` and `layout` fallback:

* Only if `layout` is not found in the fallback, the layout name `page` is used.
* Only if `lang` is not found in the fallback, the system default language is applied.

The layout name may need some supplementation.
The layout name is used to identify the layout file from which the conversion is being made.
For example, if the layout name is `page`, the file `layouts/page.html` will be applied. If:

```markdown
---
title: Hello MarkTheRipper!
layout: fancy
---

(... Body ...)
```

then `layouts/fancy.html` will be used.

The `date` represents the date and time of the article and is treated like an ordinary keyword,
but if it is not defined in the markdown header,
the date and time of generation will be inserted into the markdown header automatically.

The `timezone` is referenced when dealing with dates and times such as `date` and is the basis for time zone correction.
If the system timezone setting of the environment in which you run MarkTheRipper is different
from the date and time you routinely embed in your articles,
you may want to include it in the `metadata.json` file.
If your system's time zone setting is different from the date and time you routinely embed articles,
you may want to include it in the `metadata.json` file.
(A typical environment for this would be when running on a cloud service such as GitHub Actions.)

You may feel that `lang` is simply one of the ordinary keywords.
This is explained in the next section.

## Recursive keyword search

You may want to pull results from the metadata dictionary again,
using the keywords as the result of the metadata dictionary pull.
For example, you might want to look up:

```markdown
---
title: Hello MarkTheRipper!
category: blog
---

(... Body ...)
```

A `category` keyword is like a category of articles.
Here, it is named `blog`, but if you refer to it by keyword as follows:

```html
<p>Category: {category}</p>
```

The HTML will look like `Category: blog`.
This may work fine in some cases, but you may want to replace it with a more polite statement.
So you can have the metadata dictionary search for the value again,
using `blog` as the keyword.
Use the `lookup` function keyword built-in MarkTheRipper:

```html
<p>Category: {lookup category}</p>
```

* The details of the function keywords are explained in later chapters.

If you do this and register the pair `blog` and `Private diary` in the metadata dictionary,
the HTML will show `Category: Private diary`.

Such keyword/value pairs can be referenced by writing them in `metadata.json` as shown in the previous section.
In addition, the metadata dictionary file is actually all JSON files matched by `metadata/*.json`.
Even if the files are separated,
they will all be read and their contents merged when MarkTheRipper starts.

For example, it would be easier to manage only article categories as separate files,
such as `metadata/category.json`.

## Enumeration and nesting

For classifications such as "category" and "tag",
you would want to have the user select them from a menu and be taken to that page.
For example, suppose there are 5 tags on the entire site.
You would automatically add these to the page's menu.
To allow the user to navigate to a page classified under a tag from the menu, we can use the enumerator.
As usual, let's start with a small example.

This is the layout included in minimum:

```html
<p>Tags:{foreach tags} '{item}'{end}</p>
```

* The `tags` keyword indicates a list of tags (see below)

This means that documents between `{foreach tags}` and `{end}` will be repeated as many times as the number of `tags`.
"Documents between" are, in this case: ` '{item}'`.
Note the inclusion of spaces.
Likewise, it can contain line breaks, HTML tags, or anything else in between.

Now suppose we convert the following markdown:

```markdown
---
title: Hello MarkTheRipper
tags: foo,bar,baz
---

(... Body ...)
````

Then the output will be `<p>Tags: 'foo' 'bar'</p>`.
The `foo,bar` in `tags` have been expanded and quoted in the output, each separated by space.

Again, documents between `{foreach tags}` and `{end}` are output repeatedly, so you can use the following:

```html
<ul>
  {foreach tags}
  <li>{item.index}/{item.count} {item}</li>
  {end}
</ul>
```

Result:

```html
<ul>
  <li>0/3 foo</li>
  <li>1/3 bar</li>
  <li>2/3 baz</li>
</ul>
```

The `{item}` inserted between the tags is a keyword that can refer to each repeated value.
Also, specifying `{item.index}` will give you a number starting from 0 and counting 1,2,3....
`{item.count}` is the number of repetitions.
In the above there are 3 tags, so this value is always 3.

In addition, you can nest different keywords.
For example, for each category and you can enumerate multiple tags.

In addition, multiple keywords can be nested.
The following example repeats the tag twice:

```html
<ul>
  {foreach tags}
  {foreach tags}
  <li>{item.index} {item}</li>
  {end}
  {end}
</ul>
```

Result:

```html
<ul>
  <li>0 foo</li>
  <li>1 bar</li>
  <li>0 foo</li>
  <li>1 bar</li>
</ul>
```

Note, by the way, that `item` in this case refers to a double nested inner `tags` iteration.
In some cases, you may want to use the value of the outer iteration.
In that situation, you can specify a "bound name" for the `foreach`:

```html
<ul>
  {foreach tags tag1}
  {foreach tags tag2}
  <li>{tag1.index}-{tag2.index} {tag1}/{tag2}</li>
  {end}
  {end}
</ul>
```

Result:

```html
<ul>
  <li>0-0 foo/foo</li>
  <li>0-1 foo/bar</li>
  <li>1-0 bar/foo</li>
  <li>1-1 bar/bar</li>
</ul>
```

If the bound name is omitted, `item` is used.
Now you have a grasp of how to use `foreach` for repetition.

## Replacing keywords in markdown

The keyword replacement described so far is for "Layout" files.
It feature applies equally to markdown files.
For example, the keyword replacement in:

```markdown
---
title: hoehoe
tags: foo,bar,baz
---

Title: {title}
```

If you write such a markdown, `{title}` will be keyword-substituted in the same way.
Of course, the function keyword calculations described so far are also possible.

Keyword substitution on markdown does not work for code blocks:

````markdown
---
title: hoehoe
tags: foo,bar,baz
---

Title: `{title}`

```
{title}
```
````

As shown above, `{...}` are not interpreted by MarkTheRipper and are output as is.
